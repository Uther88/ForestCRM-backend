(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{T6rQ:function(t,a,e){},ZTUr:function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"nakopitelnaya-vedomost"}},[e("div",{staticClass:"row bg-indigo q-pa-sm full-width justify-between"},[e("q-field",{staticClass:"col-md-3 items-center col-xs-12 q-pa-xs",attrs:{label:"Участок","label-width":"3"}},[e("q-select",{staticClass:"bg-white round-borders",staticStyle:{padding:"5px"},attrs:{options:t.options.stations.map(function(t){return{label:t.name,value:t.id}}),separator:"","hide-underline":"",disable:!this.$user.is_staff||!t.is_editable},model:{value:t.form.station,callback:function(a){t.$set(t.form,"station",a)},expression:"form.station"}})],1),e("q-field",{staticClass:"col-md-2 col-xs-12 q-pa-xs",attrs:{label:"Отдел"}},[e("q-select",{staticClass:"bg-white round-borders",staticStyle:{padding:"5px"},attrs:{options:t.$store.state.main.departaments,separator:"","hide-underline":"",disable:!t.is_editable},model:{value:t.form.departament,callback:function(a){t.$set(t.form,"departament",a)},expression:"form.departament"}})],1),e("q-field",{staticClass:"col-md-2 col-xs-12 q-pa-xs",attrs:{label:"Дата"}},[e("q-datetime",{staticClass:"bg-white round-borders",staticStyle:{padding:"5px"},attrs:{type:"date",value:t.form.date,"format-model":"date",format:"MM.YYYY",align:"center","hide-underline":"","default-view":"month",modal:"",disable:!t.is_editable},on:{input:function(a){t.form.date=new Date(a).toLocaleDateString("EU")}}})],1),e("q-field",{staticClass:"col-md-4 col-xs-12 q-pa-xs",attrs:{label:"Вид работ","label-width":"3"}},[e("q-select",{staticClass:"bg-white round-borders",staticStyle:{padding:"5px"},attrs:{options:t.options.events.map(function(t){return{label:t.full_name,value:t.id}}),"hide-underline":"",separator:"",clearable:"",filter:"",disable:!t.is_editable},model:{value:t.form.event,callback:function(a){t.$set(t.form,"event",a)},expression:"form.event"}})],1),e("div",{staticClass:"col-md-1 col-xs-12 text-center q-pa-xs"},[e("q-btn",{attrs:{color:"positive",glossy:"",icon:"search",disabled:!t.filter_is_valid},on:{click:t.getDocuments}})],1)],1),e("div",{staticClass:"row group"},[e("q-table",{staticClass:"col-md col-xs-12",attrs:{data:t.docs.outfits,columns:t.outfit_columns,pagination:{rowsPerPage:0},"hide-bottom":"",dense:"",separator:"cell","table-style":"min-height: 30vh;"},scopedSlots:t._u([{key:"top",fn:function(a){return[e("div",{staticClass:"full-width text-center"},[t._v("\n\t\t\t\t\tНаряд-Акты\n\t\t\t\t")])]}},{key:"bottom-row",fn:function(a){return e("tr",{staticClass:"bg-grey-2 tfoot"},[e("td",[t._v("Всего: "+t._s(t.docs.outfits.length))]),e("td"),e("td"),e("td",[t._v(t._s(t.docs.outfits.map(function(t){return t.days_total}).reduce(function(t,a){return parseFloat(t)+parseFloat(a)},0)))]),e("td",[t._v(t._s(t.docs.outfits.map(function(t){return t.hours_total}).reduce(function(t,a){return parseFloat(t)+parseFloat(a)},0)))]),e("td",[t._v(t._s(t.docs.outfits.map(function(t){return t.amount_total}).reduce(function(t,a){return parseFloat(t)+parseFloat(a)},0)))])])}}])}),e("q-table",{staticClass:"col-md col-xs-12",attrs:{"table-style":"min-height: 30vh;",data:t.docs.regforms,columns:t.regform_columns,pagination:{rowsPerPage:0},"hide-bottom":"",dense:"",separator:"cell"},scopedSlots:t._u([{key:"top",fn:function(a){return[e("div",{staticClass:"full-width text-center"},[t._v("\n\t\t\t\t\tУчетные листы тракториста\n\t\t\t\t")])]}},{key:"bottom-row",fn:function(a){return e("tr",{staticClass:"bg-grey-2 tfoot"},[e("td",[t._v("Всего: "+t._s(t.docs.regforms.length))]),e("td"),e("td"),e("td",[t._v(t._s(t.docs.regforms.map(function(t){return t.total_hours}).reduce(function(t,a){return parseFloat(t)+parseFloat(a)},0)))]),e("td",[t._v(t._s(t.docs.regforms.map(function(t){return t.amount_total}).reduce(function(t,a){return parseFloat(t)+parseFloat(a)},0)))])])}}])})],1),e("div",{staticClass:"row q-px-xs",staticStyle:{overflow:"scroll","min-height":"35vh","max-height":"50vh"}},[e("table",{staticClass:"q-table calcs-table"},[e("caption",{staticClass:"bg-grey-3 q-py-xs",staticStyle:{position:"relative"}},[e("q-btn",{staticClass:"float-left q-ml-sm",staticStyle:{"font-weight":"bold"},attrs:{glossy:"",label:"Расчитать",color:"positive",disabled:!t.is_calculable},on:{click:t.calculate}}),e("span",{staticClass:"absolute-center",staticStyle:{"vertical-align":"middle","line-height":"2"}},[t._v("Расчеты")])],1),t._m(0),e("tbody",t._l(t.docs.calcs,function(a,s){return e("tr",[e("td",[t._v(t._s(s+1))]),e("td",[t._v(t._s(a.worker))]),e("td",[t._v(t._s(a.man_days))]),e("td",[t._v(t._s(a.number))]),e("td",[t._v(t._s(a.complexity))]),e("td",[t._v(t._s(a.importance))]),e("td",[t._v(t._s(a.bonus))]),e("td",[t._v(t._s(a.coefficient))]),e("td",[t._v(t._s(a.classines))]),e("td",[t._v(t._s(a.amount))]),e("td",[t._v(t._s(a.amount_complexity))]),e("td",[t._v(t._s(a.amount_importance))]),e("td",[t._v(t._s(a.recast_half))]),e("td",[t._v(t._s(a.recast_double))]),e("td",[t._v(t._s(a.holydays))]),e("td",[t._v(t._s(a.amount_bonus))]),e("td",[t._v(t._s(a.amount_coefficient))]),e("td",[t._v(t._s(a.amount_classines))]),e("td",[t._v(t._s(a.amount_total))])])})),t.docs.calcs.length?e("tfoot",{staticStyle:{"font-size":"10pt"}},[e("tr",{staticClass:"bg-grey-2",staticStyle:{"font-weight":"bold"}},[e("td",[t._v(t._s(t.docs.calcs.length))]),e("td"),e("td",[t._v(t._s(t.form.man_days))]),e("td"),e("td"),e("td"),e("td"),e("td"),e("td"),e("td",[t._v(t._s(t.form.amount))]),e("td",[t._v(t._s(t.form.complexity))]),e("td",[t._v(t._s(t.form.importance))]),e("td",[t._v(t._s(t.form.recast_half))]),e("td",[t._v(t._s(t.form.recast_double))]),e("td",[t._v(t._s(t.form.holydays))]),e("td",[t._v(t._s(t.form.bonus))]),e("td",[t._v(t._s(t.form.coefficient))]),e("td",[t._v(t._s(t.form.classines))]),e("td",[t._v(t._s(t.form.amount_total))])])]):t._e()])]),e("div",{staticClass:"row justify-center group"},[e("q-btn",{attrs:{icon:"clear",color:"negative",label:"Отчистить"},on:{click:t.resetAll}}),e("q-btn",{attrs:{icon:"save",label:"Сохранить",color:"positive",disabled:!t.docs.calcs.length},on:{click:t.save}})],1)])},o=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("thead",[e("tr",[e("th",{attrs:{rowspan:"2",width:"3%"}},[t._v("№"),e("br"),t._v("п/п")]),e("th",{attrs:{rowspan:"2",w:""}},[t._v("Ф.И.О.")]),e("th",{attrs:{rowspan:"2",width:"5%"}},[t._v("Чел-дни"),e("br"),t._v("машино-смен")]),e("th",{attrs:{rowspan:"2",width:"3%"}},[t._v("№"),e("br"),t._v("наряда")]),e("th",{attrs:{rowspan:"2",width:"5%"}},[t._v("Сложность"),e("br"),t._v("(условия труда)"),e("br"),t._v("%")]),e("th",{attrs:{rowspan:"2",width:"5%"}},[t._v("Ответств."),e("br"),t._v("работы"),e("br"),t._v("%")]),e("th",{attrs:{rowspan:"2",width:"5%"}},[t._v("Премия"),e("br"),t._v("%")]),e("th",{attrs:{rowspan:"2",width:"5%"}},[t._v("Коэффи-"),e("br"),t._v("циент")]),e("th",{attrs:{rowspan:"2",width:"5%"}},[t._v("Классность"),e("br"),t._v("%")]),e("th",{staticClass:"bg-blue-2 text-black",attrs:{colspan:"10"}},[t._v("Оплата")])]),e("tr",[e("th",{attrs:{width:"5%"}},[t._v("Начислено")]),e("th",{attrs:{width:"5%"}},[t._v("Сложность"),e("br"),t._v("(усл. труда)")]),e("th",{attrs:{width:"5%"}},[t._v("Ответств."),e("br"),t._v("работы")]),e("th",{attrs:{width:"5%"}},[t._v("Переработка"),e("br"),t._v("в 1,5 раза")]),e("th",{attrs:{width:"5%"}},[t._v("Переработка"),e("br"),t._v("в 2 раза")]),e("th",{attrs:{width:"5%"}},[t._v("Выходные")]),e("th",{attrs:{width:"5%"}},[t._v("Премия")]),e("th",{attrs:{width:"5%"}},[t._v("Коэффи-"),e("br"),t._v("циент")]),e("th",{attrs:{width:"5%"}},[t._v("Классность")]),e("th",{attrs:{width:"5%"}},[t._v("Всего")])])])}];s._withStripped=!0;e("rGqo");var n={name:"NakopitelnayaVedomostNewPage",data:function(){return{options:{stations:[],events:[]},docs:{outfits:[],regforms:[],calcs:[]},form:{station:this.$user.station||null,date:null,departament:null,event:null,outfits:[],regforms:[],man_days:null,amount:null,complexity:null,importance:null,bonus:null,coefficient:null,classines:null,recast_half:null,recast_double:null,holydays:null,amount_total:null},outfit_columns:[{label:"Номер",name:"id",field:"id",align:"center"},{label:"Лесничество",name:"forestry",field:"forestry",align:"center"},{label:"Бригадир",name:"brigadier",field:function(t){return t.brigadier.full_name},align:"center"},{label:"Дней",name:"days_total",field:function(t){return parseFloat(t.days_total)},align:"center"},{label:"Часов",name:"hours_total",field:function(t){return parseFloat(t.hours_total)},align:"center"},{label:"Оплата",name:"amount_total",field:"amount_total",align:"center"}],regform_columns:[{label:"Номер",name:"id",field:"id",align:"center"},{label:"Бригадир",name:"brigadier",field:function(t){return t.brigadier.full_name},align:"center"},{label:"Тракторист",name:"driver",field:function(t){return t.driver.full_name},align:"center"},{label:"Часов",name:"total_hours",field:function(t){return parseFloat(t.total_hours)},align:"center"},{label:"Оплата",name:"amount_total",field:"amount_total",align:"center"}]}},methods:{save:function(){var t=this;if(this.docs.calcs.length){var a=JSON.parse(JSON.stringify(this.form));this.$axios.post("/api/v1/nakopitelnie_vedomosti/",a).then(function(a){t.done(a.data.id)}).catch(function(a){t.handleError(a)})}},done:function(t){var a=this;this.$q.dialog({title:"Готово",message:"Открыть печатную форму?",ok:!0,cancel:!0}).then(function(){a.$router.push({name:"PrintNakopitelnayaVedomostVedomost",params:{id:t}})}).catch(function(){a.$router.push({name:"NakopitelnayaVedomost"})})},calcRegforms:function(){var t=this;this.docs.regforms.forEach(function(a){var e={};e.worker=a.driver.full_name,e.man_days=a.total_hours,e.number=a.id,e.importance=a.importance,e.complexity=a.complexity,e.classines=a.classines,e.bonus=a.bonus,e.amount=a.amount,e.amount_bonus=a.amount_bonus,e.amount_complexity=a.amount_complexity,e.amount_importance=a.amount_importance,e.amount_classines=a.amount_classines,e.amount_total=a.amount_total,t.form.regforms.push(a.id),t.docs.calcs.push(e)})},calcOutfits:function(){var t=this;this.docs.outfits.forEach(function(a){a.tables.forEach(function(e){var s={};s.worker=e.worker.full_name,s.man_days=e.hours,s.number=a.id,s.complexity=a.conditions,s.bonus=a.bonus,s.importance=a.importance,s.coefficient=a.coefficient,s.amount=e.tariff_rate,s.amount_bonus=e.bonus,s.amount_importance=e.importance,s.amount_complexity=e.by_conditions,s.amount_coefficient=e.by_coefficient,s.amount_total=e.total,t.docs.calcs.push(s)}),t.form.outfits.push(a.id)})},calculate:function(){this.docs.outfits.length&&this.calcOutfits(),this.docs.regforms.length&&this.calcRegforms()},getStations:function(){var t=this;this.$axios.get("/api/v1/stations/").then(function(a){t.options.stations=a.data.stations}).catch(function(a){t.handleError(a)})},getEvents:function(){var t=this;this.$axios.get("/api/v1/outfit_events/").then(function(a){t.options.events=a.data.outfit_events}).catch(function(a){t.handleError(a)})},getOutfits:function(t){var a=this,e={conducted:!1};e.station=t.station,e.departament=t.departament,e.event=t.event,e.begin__month=new Date(t.date).getMonth()+1,e.end__month=new Date(t.date).getMonth()+1,this.$axios.get("/api/v1/outfit/",{params:e}).then(function(t){a.docs.outfits=t.data.outfits}).catch(function(t){a.handleError(t)})},getRegforms:function(t){var a=this,e={conducted:!1};e.station=t.station,e.departament=t.departament,e.event=t.event,e.date__month=new Date(t.date).getMonth()+1,this.$axios.get("/api/v1/tractor-regform/",{params:e}).then(function(t){a.docs.regforms=t.data.regforms}).catch(function(t){a.handleError(t)})},getDocuments:function(){if(this.filter_is_valid){this.docs.outfits=[],this.docs.regforms=[],this.docs.calcs=[],this.form.regforms=[],this.form.outfits=[];var t={station:this.form.station,departament:this.form.departament,date:this.form.date,event:this.form.event};this.getRegforms(t),this.getOutfits(t)}},handleError:function(t){this.$q.notify({message:t.message,position:"bottom-right"})},resetAll:function(){this.docs.outfits=[],this.docs.regforms=[],this.docs.calcs=[],this.form.event=null,this.form.departament=null,this.form.date=null}},mounted:function(){this.getStations(),this.getEvents()},computed:{is_editable:function(){return!(this.docs.regforms.length>0||this.docs.outfits.length)},filter_is_valid:function(){return this.form.station&&this.form.departament&&this.form.event},is_calculable:function(){return!this.docs.calcs.length&&(this.docs.outfits.length||this.docs.regforms.length)}},watch:{"docs.calcs":function(t){var a=0,e=0,s=0,o=0,n=0,i=0,r=0,l=0,c=0,d=0,u=0;this.docs.calcs.forEach(function(t){d+=parseFloat(t.man_days),a+=parseFloat(t.amount),e+=parseFloat(t.amount_coefficient)||0,s+=parseFloat(t.amount_importance)||0,o+=parseFloat(t.amount_classines)||0,n+=parseFloat(t.recast_half)||0,i+=parseFloat(t.recast_double)||0,r+=parseFloat(t.holydays)||0,l+=parseFloat(t.amount_complexity)||0,c+=parseFloat(t.amount_bonus)||0,u+=parseFloat(t.amount_total)}),this.form.man_days=d,this.form.amount=a,this.form.complexity=l,this.form.classines=o,this.form.importance=s,this.form.recast_half=n,this.form.recast_double=i,this.form.holydays=r,this.form.bonus=c,this.form.coefficient=e,this.form.amount_total=u}}},i=n,r=(e("jxXb"),e("KHd+")),l=Object(r["a"])(i,s,o,!1,null,null,null);a["default"]=l.exports},jxXb:function(t,a,e){"use strict";var s=e("T6rQ"),o=e.n(s);o.a}}]);