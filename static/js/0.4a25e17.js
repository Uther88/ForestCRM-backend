(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[0],{"6f4c":function(t,e,s){},U7oy:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("q-table",{attrs:{data:t.tasks,columns:t.tasksColums,"visible-columns":t.visibleColumns,"row-key":"id","table-class":"tasksTable",dense:"",loading:t.loading,"table-style":{"min-height":t.$store.state.main.screen.height-200+"px"}},scopedSlots:t._u([{key:"body-cell-options",fn:function(e){return s("q-td",{attrs:{props:e}},[s("q-btn",{attrs:{rounded:"",color:"primary",icon:"menu"}},[s("q-popover",[s("q-list",{attrs:{separator:"",link:""}},[s("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(s){t.detailTask=e.row}}},[s("q-item-side",{attrs:{color:"primary",icon:"zoom in"}}),s("q-item-main",[t._v("Просмотр")])],1),e.row.is_completed||e.row.performer.id!=t.$user.id?t._e():s("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(s){t.completeTask(e.row)}}},[s("q-item-side",{attrs:{color:"primary",icon:"check"}}),s("q-item-main",[t._v("Выполнено")])],1),e.row.assigner.id==t.$user.id?s("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],nativeOn:{click:function(s){t.removeTask(e.row)}}},[s("q-item-side",{attrs:{color:"red",icon:"remove"}}),s("q-item-main",[t._v("Удалить")])],1):t._e()],1)],1)],1)],1)}},{key:"body-cell-importance",fn:function(e){return s("q-td",{attrs:{props:e}},["warning"==e.value?s("q-chip",{attrs:{small:"",square:"",color:"orange"}},[t._v("Средняя")]):t._e(),"danger"==e.value?s("q-chip",{attrs:{small:"",square:"",color:"red"}},[t._v("Высокая")]):t._e(),"success"==e.value?s("q-chip",{attrs:{small:"",square:"",color:"positive"}},[t._v("Низкая")]):t._e()],1)}},{key:"body-cell-status",fn:function(e){return s("q-td",{attrs:{props:e}},[e.value?s("q-icon",{attrs:{name:"check circle",color:"positive",size:"1.5rem"}},[s("q-tooltip",[t._v("Выполнено")])],1):!e.value&&new Date(e.row.to_complete)>new Date?s("q-spinner-hourglass",{attrs:{color:"orange",size:"25"}},[s("q-tooltip",[t._v("В процессе")])],1):s("q-icon",{attrs:{name:"alarm off",size:"1.5rem",color:"red"}},[s("q-tooltip",[t._v("Просроченно")])],1)],1)}},{key:"body-cell-viewed",fn:function(e){return s("q-td",{attrs:{props:e}},[e.value?s("q-icon",{attrs:{name:"visibility",color:"positive",size:"1.5rem"}},[s("q-tooltip",[t._v("Просмотренно")])],1):s("q-icon",{attrs:{name:"visibility_off",size:"1.5rem",color:"red"}},[s("q-tooltip",[t._v("Не просмотренно")])],1)],1)}},{key:"bottom",fn:function(e){return s("div",{staticClass:"row justify-end items-center q-pa-sm fit"},[s("q-btn",{staticClass:"q-mr-sm",attrs:{round:"",dense:"",size:"sm",icon:"undo",color:"secondary",disable:!t.prev},on:{click:t.prevPage}}),s("div",{staticClass:"q-mr-sm",staticStyle:{"font-size":"small"}},[t._v("\n         Страница "+t._s(e.pagination.page)+" / "+t._s(e.pagesNumber)+"\n       ")]),s("q-btn",{attrs:{round:"",dense:"",size:"sm",icon:"redo",color:"secondary",disable:!t.next},on:{click:t.nextPage}})],1)}}])})],1),t.detailTask?s("task-detail",{attrs:{task:t.detailTask,hide:function(){t.detailTask=null}}}):t._e()],1)},i=[];a._withStripped=!0;s("f3/d");var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-modal",{attrs:{"content-css":"max-height: 100%; min-width: 40vw;"},on:{hide:t.hide},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[s("div",{staticClass:"taskDetail flex column full-height justify-between"},[s("q-toolbar",{attrs:{glossy:"",color:"indigo"}},[s("q-toolbar-title",{attrs:{align:"center"}},[t._v("Просмотр задания")]),s("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],attrs:{flat:"",icon:"close"}})],1),s("div",{staticClass:"text-center q-py-sm"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-4 text-bold"},[t._v("\n            Назначающий:\n          ")]),s("div",{staticClass:"col text-left offset-2"},[s("q-chip",{staticClass:"text-black",attrs:{color:"white",avatar:t.task.assigner.avatar||"/statics/anon.png"}},[t._v(t._s(t.task.assigner.full_name))])],1)]),s("div",{staticClass:"row q-pa-sm"},[s("div",{staticClass:"col-4 text-bold"},[t._v("\n            Выполняющий:\n          ")]),s("div",{staticClass:"col offset-2 text-left"},[s("q-chip",{staticClass:"text-black",attrs:{color:"white",avatar:t.task.performer.avatar||"/statics/anon.png"}},[t._v(t._s(t.task.performer.full_name))])],1)]),s("div",{staticClass:"row q-pa-sm"},[s("div",{staticClass:"col-4 text-bold"},[t._v("\n            Важность:\n          ")]),s("div",{staticClass:"col"},["warning"==t.task.importance?s("q-chip",{staticClass:"shadow-1 no-border",attrs:{small:"",square:"",color:"orange"}},[t._v("Средняя")]):t._e(),"danger"==t.task.importance?s("q-chip",{staticClass:"shadow-1 no-border",attrs:{small:"",square:"",color:"red"}},[t._v("Высокая")]):t._e(),"success"==t.task.importance?s("q-chip",{staticClass:"shadow-1 no-border",attrs:{small:"",square:"",color:"positive"}},[t._v("Низкая")]):t._e()],1)]),s("div",{staticClass:"row q-pa-sm"},[s("div",{staticClass:"col-4 text-bold"},[t._v("\n            Статус:\n          ")]),s("div",{staticClass:"col"},[t.task.is_completed?s("q-icon",{attrs:{name:"check circle",color:"positive",size:"1.5rem"}},[s("q-tooltip",[t._v("Выполнено")])],1):!t.task.is_completed&&new Date(t.task.to_complete)>new Date?s("q-spinner-hourglass",{attrs:{color:"orange",size:"25"}},[s("q-tooltip",[t._v("В процессе")])],1):s("q-icon",{attrs:{name:"alarm off",size:"1.5rem",color:"red"}},[s("q-tooltip",[t._v("Просроченно")])],1),t.task.viewed?s("q-icon",{attrs:{name:"visibility",color:"green",size:"1.5rem"}}):s("q-icon",{attrs:{name:"visibility_off",color:"red",size:"1.5rem"}})],1)]),t.task.is_completed?s("div",{staticClass:"row q-pa-sm"},[t.task.is_completed?s("div",{staticClass:"col-4 text-bold"},[t._v("\n            Выполнено:\n          ")]):t._e(),t.task.is_completed?s("div",{staticClass:"col text-bold"},[s("q-chip",{attrs:{color:"positive",square:""}},[t._v("\n              "+t._s(new Date(t.task.completed_date).toLocaleTimeString())+"\n            ")]),s("q-chip",{attrs:{color:"positive",square:""}},[t._v("\n              "+t._s(new Date(t.task.completed_date).toLocaleDateString())+"\n            ")])],1):t._e()]):t._e(),s("div",{staticClass:"row q-pa-sm flex-center"},[s("div",{staticClass:"col-4 text-bold"},[t._v("\n              Выполнить до:\n            ")]),s("div",{staticClass:"col text-bold group"},[s("q-chip",{attrs:{square:"",color:"negative"}},[t._v(t._s(new Date(t.task.to_complete).toLocaleTimeString()))]),s("q-chip",{attrs:{square:"",color:"negative"}},[t._v("\n              "+t._s(new Date(t.task.to_complete).toLocaleDateString())+"\n              ")])],1)]),s("div",{staticClass:"row q-pa-sm hidden"},[s("div",{staticClass:"col-4 text-bold"},[t._v("\n              Создано:\n            ")]),s("div",{staticClass:"col"},[s("q-chip",{attrs:{color:"primary"}},[t._v("\n              "+t._s(new Date(t.task.created_date).toLocaleString()))])],1)]),s("div",{staticClass:"row q-pa-sm"},[s("div",{staticClass:"col-4 text-bold"},[t._v("\n              Название:\n            ")]),s("div",{staticClass:"col text-left shadow-1 q-pa-sm"},[t._v("\n                "+t._s(t.task.title)+"\n            ")])]),s("div",{staticClass:"row q-pa-sm"},[s("div",{staticClass:"col-4 text-bold"},[t._v("\n            Описание:\n          ")]),s("div",{staticClass:"col text-left shadow-1 q-pa-sm"},[t._v("\n            "+t._s(t.task.text)+"\n          ")])]),s("div",{staticClass:"row q-pa-sm"},[s("div",{staticClass:"col-4 text-bold"},[t._v("\n            Файлы:\n          ")]),s("div",{staticClass:"col text-left shadow-1"},[s("ol",t._l(t.task.files,function(e){return s("li",{key:e.id,staticClass:"q-pa-xs"},[s("a",{staticStyle:{"text-decoration":"none","border-bottom":"1px dotted"},attrs:{href:e.file}},[t._v(t._s(e.title)),s("q-icon",{attrs:{name:"file download",size:"1.5rem"}})],1)])})),t.task.files.length?t._e():s("p",{staticClass:"text-center"},[t._v("\n              Нет\n            ")])])])]),s("q-toolbar",{staticClass:"justify-around self-end",attrs:{glossy:"",color:"indigo"}},[t.task.assigner.id==t.$user.id?s("q-btn",{attrs:{color:"negative",label:"Удалить",icon:"remove"},nativeOn:{click:function(e){t.removeTask(t.task)}}}):t._e(),t.task.is_completed||t.task.performer.id!=t.$user.id?t._e():s("q-btn",{attrs:{color:"positive",label:"Выполнено",icon:"check"},nativeOn:{click:function(e){t.completeTask(t.task)}}}),s("q-btn",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],staticClass:"text-bold",attrs:{icon:"close",color:"deep-orange",label:"Закрыть"}})],1)],1)])},n=[];o._withStripped=!0;var r={name:"DetailTaskPage",props:{task:{required:!0,type:Object},hide:{required:!0}},data:function(){return{opened:!1}},methods:{viewTask:function(){var t=this;this.task&&!this.task.viewed&&this.task.performer.id==this.$user.id&&this.$axios.put("/api/v1/task/"+this.task.id+"/",{viewed:!0}).then(function(e){t.task.viewed=!0}).catch(function(t){})},completeTask:function(t){var e=this;t&&!t.is_completed&&this.$axios.put("/api/v1/task/"+t.id+"/",{is_completed:!0}).then(function(t){e.opened=!1}).catch(function(t){})},removeTask:function(t){var e=this;t&&t.assigner.id==this.$user.id&&this.$axios.delete("/api/v1/task/"+t.id+"/").then(function(t){e.opened=!1}).catch(function(t){})}},mounted:function(){this.task&&(this.opened=!0,this.viewTask())}},l=r,c=(s("gIkN"),s("KHd+")),d=Object(c["a"])(l,o,n,!1,null,null,null),m=d.exports,u={name:"TasksPage",props:["path"],components:{"task-detail":m},data:function(){return{url:"/api/v1/task/",loading:!1,next:null,prev:null,detailTask:null,pagination:{page:1,rowsPerPage:20,rowsNumber:0},tasksColums:[{name:"options",label:"Опции",field:"id"},{name:"importance",label:"Важность",field:"importance",align:"center",sortable:!0,sort:function(t,e){return t>e}},{name:"status",label:"Статус",field:"is_completed",align:"center",sortable:!0,sort:function(t,e){return t-e}},{name:"viewed",label:"Просмотренно",field:"viewed",align:"center",sortable:!0,sort:function(t,e){return t-e}},{name:"to_complete",label:"Выполнить до",field:"to_complete",align:"center",format:function(t){return new Date(t).toLocaleString()},sortable:!0},{name:"assigner",label:"Назначающий",field:function(t){return t.assigner.full_name},align:"center",sortable:!0},{name:"performer",label:"Выполняющий",field:function(t){return t.performer.full_name},align:"center",sortable:!0},{name:"title",label:"Название",field:function(t){return t.title.slice(0,20)+"..."},align:"center"},{name:"text",label:"Описание",field:function(t){return t.text.slice(0,35)+"..."},align:"center"},{name:"created_date",label:"Создано",field:"created_date",align:"center",format:function(t){return new Date(t).toLocaleString()}},{name:"completed_date",label:"Выполнено",field:"completed_date",align:"center",format:function(t){return t?new Date(t).toLocaleString():"---"}},{name:"files",label:"Файлы",field:function(t){return t.files.length},align:"center"}],tasks:[]}},methods:{completeTask:function(t){var e=this;t&&!t.is_completed&&this.$axios.put("/api/v1/task/"+t.id+"/",{is_completed:!0}).then(function(t){e.getTasks()}).catch(function(t){})},removeTask:function(t){var e=this;t&&t.assigner.id==this.$user.id&&this.$axios.delete("/api/v1/task/"+t.id+"/").then(function(s){e.tasks=e.tasks.filter(function(e){e.id,t.id})}).catch(function(t){})},nextPage:function(t){this.pagination.page++,this.getTasks(this.next)},prevPage:function(t){this.pagination.page--,this.getTasks(this.prev)},getTasks:function(t){var e=this;this.loading=!0;var s={limit:this.pagination.rowsPerPage};"inbox"==this.path?s.performer=this.$user.id:s.assigner=this.$user.id,this.$axios.get(t||this.url,{params:s}).then(function(t){e.tasks=t.data.tasks,e.pagination.rowsNumber=t.data.meta.total_count,e.prev=t.data.meta.previous,e.next=t.data.meta.next}).catch(function(t){}).finally(function(){e.loading=!1})}},mounted:function(){this.getTasks(),this.tasksGetter=setInterval(this.getTasks,1e4)},destroyed:function(){clearInterval(this.tasksGetter)},watch:{path:function(){this.tasks=[],this.getTasks()}},computed:{visibleColumns:function(){var t=[];return t=this.$q.platform.is.desktop?this.tasksColums.map(function(t){return t.name}):this.tasksColums.map(function(t){return t.name}).filter(function(t){return"title"!=t&&"text"!=t}),"inbox"==this.path?t.filter(function(t){return"performer"!==t}):t.filter(function(t){return"assigner"!==t})}}},v=u,p=(s("hkYB"),Object(c["a"])(v,a,i,!1,null,null,null));e["default"]=p.exports},gIkN:function(t,e,s){"use strict";var a=s("6f4c"),i=s.n(a);i.a},hkYB:function(t,e,s){"use strict";var a=s("pcU2"),i=s.n(a);i.a},pcU2:function(t,e,s){}}]);